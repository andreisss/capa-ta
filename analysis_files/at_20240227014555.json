{"meta": {"timestamp": "2024-02-27T01:45:53.310975", "version": "7.0.1", "argv": ["-r", "/opt/capa-rules-7.0.1/", "-j", "/tmp/at.exe"], "sample": {"md5": "e294e6d8f56297a5931c585a94aca617", "sha1": "fe40276ac22804d088da3e828ec89dd81df06ee2", "sha256": "b60f72cee81b16c90782d62def07d514013dbb4d2bc545981f4decd01d722784", "path": "/tmp/at.exe"}, "flavor": "static", "analysis": {"format": "pe", "arch": "amd64", "os": "windows", "extractor": "VivisectFeatureExtractor", "rules": ["/opt/capa-rules-7.0.1"], "base_address": {"type": "absolute", "value": 5368709120}, "layout": {"functions": [{"address": {"type": "absolute", "value": 5368713232}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368713232}}, {"address": {"type": "absolute", "value": 5368713254}}, {"address": {"type": "absolute", "value": 5368713436}}]}, {"address": {"type": "absolute", "value": 5368713456}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368713456}}]}, {"address": {"type": "absolute", "value": 5368713536}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368713599}}, {"address": {"type": "absolute", "value": 5368713719}}, {"address": {"type": "absolute", "value": 5368713760}}, {"address": {"type": "absolute", "value": 5368713828}}, {"address": {"type": "absolute", "value": 5368713980}}]}, {"address": {"type": "absolute", "value": 5368714016}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368713599}}, {"address": {"type": "absolute", "value": 5368713719}}, {"address": {"type": "absolute", "value": 5368713760}}, {"address": {"type": "absolute", "value": 5368713828}}, {"address": {"type": "absolute", "value": 5368713980}}]}, {"address": {"type": "absolute", "value": 5368714536}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368714536}}, {"address": {"type": "absolute", "value": 5368714663}}, {"address": {"type": "absolute", "value": 5368714698}}]}, {"address": {"type": "absolute", "value": 5368714800}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368714800}}, {"address": {"type": "absolute", "value": 5368714821}}, {"address": {"type": "absolute", "value": 5368714850}}]}, {"address": {"type": "absolute", "value": 5368714924}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368714924}}, {"address": {"type": "absolute", "value": 5368714964}}, {"address": {"type": "absolute", "value": 5368715000}}]}, {"address": {"type": "absolute", "value": 5368715016}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368715050}}, {"address": {"type": "absolute", "value": 5368715080}}]}, {"address": {"type": "absolute", "value": 5368715296}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368715306}}]}, {"address": {"type": "absolute", "value": 5368715640}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368715640}}]}, {"address": {"type": "absolute", "value": 5368715688}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368715688}}, {"address": {"type": "absolute", "value": 5368716246}}]}, {"address": {"type": "absolute", "value": 5368716304}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368716340}}, {"address": {"type": "absolute", "value": 5368716420}}]}, {"address": {"type": "absolute", "value": 5368716704}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368717022}}]}, {"address": {"type": "absolute", "value": 5368717044}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368717044}}, {"address": {"type": "absolute", "value": 5368717126}}]}, {"address": {"type": "absolute", "value": 5368717140}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368717140}}]}, {"address": {"type": "absolute", "value": 5368717220}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368717220}}, {"address": {"type": "absolute", "value": 5368717315}}, {"address": {"type": "absolute", "value": 5368717558}}, {"address": {"type": "absolute", "value": 5368717576}}, {"address": {"type": "absolute", "value": 5368717633}}]}, {"address": {"type": "absolute", "value": 5368717704}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368717790}}]}, {"address": {"type": "absolute", "value": 5368717832}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368718094}}, {"address": {"type": "absolute", "value": 5368718102}}, {"address": {"type": "absolute", "value": 5368718353}}]}, {"address": {"type": "absolute", "value": 5368718520}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368718642}}, {"address": {"type": "absolute", "value": 5368718777}}, {"address": {"type": "absolute", "value": 5368718888}}, {"address": {"type": "absolute", "value": 5368718999}}, {"address": {"type": "absolute", "value": 5368719097}}, {"address": {"type": "absolute", "value": 5368719208}}, {"address": {"type": "absolute", "value": 5368719348}}, {"address": {"type": "absolute", "value": 5368719415}}]}, {"address": {"type": "absolute", "value": 5368719444}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368719517}}, {"address": {"type": "absolute", "value": 5368719585}}, {"address": {"type": "absolute", "value": 5368719595}}, {"address": {"type": "absolute", "value": 5368719615}}, {"address": {"type": "absolute", "value": 5368719647}}, {"address": {"type": "absolute", "value": 5368719679}}]}, {"address": {"type": "absolute", "value": 5368719708}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368719708}}, {"address": {"type": "absolute", "value": 5368719779}}]}, {"address": {"type": "absolute", "value": 5368719836}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368719836}}, {"address": {"type": "absolute", "value": 5368719996}}]}, {"address": {"type": "absolute", "value": 5368720028}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368720028}}, {"address": {"type": "absolute", "value": 5368720079}}, {"address": {"type": "absolute", "value": 5368720130}}, {"address": {"type": "absolute", "value": 5368720143}}, {"address": {"type": "absolute", "value": 5368720161}}]}, {"address": {"type": "absolute", "value": 5368720200}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368720200}}, {"address": {"type": "absolute", "value": 5368720260}}, {"address": {"type": "absolute", "value": 5368720387}}, {"address": {"type": "absolute", "value": 5368720542}}, {"address": {"type": "absolute", "value": 5368720593}}, {"address": {"type": "absolute", "value": 5368720663}}, {"address": {"type": "absolute", "value": 5368720731}}]}, {"address": {"type": "absolute", "value": 5368720768}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368720768}}, {"address": {"type": "absolute", "value": 5368720904}}, {"address": {"type": "absolute", "value": 5368721014}}, {"address": {"type": "absolute", "value": 5368721055}}, {"address": {"type": "absolute", "value": 5368721089}}, {"address": {"type": "absolute", "value": 5368721139}}, {"address": {"type": "absolute", "value": 5368721220}}, {"address": {"type": "absolute", "value": 5368721281}}, {"address": {"type": "absolute", "value": 5368721323}}, {"address": {"type": "absolute", "value": 5368721475}}, {"address": {"type": "absolute", "value": 5368721494}}]}, {"address": {"type": "absolute", "value": 5368721624}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368721725}}]}, {"address": {"type": "absolute", "value": 5368721760}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368721808}}, {"address": {"type": "absolute", "value": 5368721869}}, {"address": {"type": "absolute", "value": 5368721901}}]}, {"address": {"type": "absolute", "value": 5368721972}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368722018}}]}, {"address": {"type": "absolute", "value": 5368722088}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368722088}}, {"address": {"type": "absolute", "value": 5368722190}}]}, {"address": {"type": "absolute", "value": 5368722212}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368722257}}]}, {"address": {"type": "absolute", "value": 5368722272}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368719836}}, {"address": {"type": "absolute", "value": 5368719996}}, {"address": {"type": "absolute", "value": 5368722272}}, {"address": {"type": "absolute", "value": 5368722335}}, {"address": {"type": "absolute", "value": 5368722401}}]}, {"address": {"type": "absolute", "value": 5368722424}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368722424}}, {"address": {"type": "absolute", "value": 5368722583}}]}, {"address": {"type": "absolute", "value": 5368722600}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368722600}}, {"address": {"type": "absolute", "value": 5368722706}}, {"address": {"type": "absolute", "value": 5368722738}}, {"address": {"type": "absolute", "value": 5368722768}}, {"address": {"type": "absolute", "value": 5368722863}}, {"address": {"type": "absolute", "value": 5368722941}}, {"address": {"type": "absolute", "value": 5368722977}}, {"address": {"type": "absolute", "value": 5368723025}}, {"address": {"type": "absolute", "value": 5368723178}}]}, {"address": {"type": "absolute", "value": 5368723376}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368723834}}]}, {"address": {"type": "absolute", "value": 5368724148}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368724148}}, {"address": {"type": "absolute", "value": 5368724562}}]}, {"address": {"type": "absolute", "value": 5368724620}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368724743}}, {"address": {"type": "absolute", "value": 5368724824}}, {"address": {"type": "absolute", "value": 5368724844}}, {"address": {"type": "absolute", "value": 5368724903}}]}, {"address": {"type": "absolute", "value": 5368724948}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368725164}}, {"address": {"type": "absolute", "value": 5368725231}}, {"address": {"type": "absolute", "value": 5368725366}}, {"address": {"type": "absolute", "value": 5368725397}}, {"address": {"type": "absolute", "value": 5368725484}}, {"address": {"type": "absolute", "value": 5368725516}}, {"address": {"type": "absolute", "value": 5368725528}}]}, {"address": {"type": "absolute", "value": 5368725580}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368725655}}, {"address": {"type": "absolute", "value": 5368725724}}, {"address": {"type": "absolute", "value": 5368725814}}, {"address": {"type": "absolute", "value": 5368725839}}, {"address": {"type": "absolute", "value": 5368726014}}, {"address": {"type": "absolute", "value": 5368726359}}]}, {"address": {"type": "absolute", "value": 5368726408}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368726408}}, {"address": {"type": "absolute", "value": 5368726588}}, {"address": {"type": "absolute", "value": 5368726646}}, {"address": {"type": "absolute", "value": 5368726691}}, {"address": {"type": "absolute", "value": 5368726728}}, {"address": {"type": "absolute", "value": 5368726851}}]}, {"address": {"type": "absolute", "value": 5368726888}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368726951}}, {"address": {"type": "absolute", "value": 5368726968}}, {"address": {"type": "absolute", "value": 5368726990}}]}, {"address": {"type": "absolute", "value": 5368727832}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368728042}}, {"address": {"type": "absolute", "value": 5368728056}}, {"address": {"type": "absolute", "value": 5368728085}}, {"address": {"type": "absolute", "value": 5368728251}}, {"address": {"type": "absolute", "value": 5368728522}}]}, {"address": {"type": "absolute", "value": 5368728572}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368728626}}, {"address": {"type": "absolute", "value": 5368728641}}, {"address": {"type": "absolute", "value": 5368728770}}]}, {"address": {"type": "absolute", "value": 5368728800}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368728841}}, {"address": {"type": "absolute", "value": 5368728853}}]}, {"address": {"type": "absolute", "value": 5368729088}, "matched_basic_blocks": [{"address": {"type": "absolute", "value": 5368729088}}]}]}, "feature_counts": {"file": 689, "functions": [{"address": {"type": "absolute", "value": 5368713232}, "count": 65}, {"address": {"type": "absolute", "value": 5368713456}, "count": 17}, {"address": {"type": "absolute", "value": 5368713536}, "count": 88}, {"address": {"type": "absolute", "value": 5368714536}, "count": 66}, {"address": {"type": "absolute", "value": 5368714800}, "count": 45}, {"address": {"type": "absolute", "value": 5368714910}, "count": 8}, {"address": {"type": "absolute", "value": 5368714924}, "count": 41}, {"address": {"type": "absolute", "value": 5368715016}, "count": 36}, {"address": {"type": "absolute", "value": 5368715092}, "count": 8}, {"address": {"type": "absolute", "value": 5368715104}, "count": 7}, {"address": {"type": "absolute", "value": 5368715296}, "count": 26}, {"address": {"type": "absolute", "value": 5368715568}, "count": 6}, {"address": {"type": "absolute", "value": 5368715577}, "count": 8}, {"address": {"type": "absolute", "value": 5368715616}, "count": 7}, {"address": {"type": "absolute", "value": 5368715640}, "count": 27}, {"address": {"type": "absolute", "value": 5368715676}, "count": 8}, {"address": {"type": "absolute", "value": 5368715688}, "count": 104}, {"address": {"type": "absolute", "value": 5368716304}, "count": 63}, {"address": {"type": "absolute", "value": 5368716440}, "count": 74}, {"address": {"type": "absolute", "value": 5368716704}, "count": 56}, {"address": {"type": "absolute", "value": 5368717044}, "count": 39}, {"address": {"type": "absolute", "value": 5368717140}, "count": 34}, {"address": {"type": "absolute", "value": 5368717220}, "count": 122}, {"address": {"type": "absolute", "value": 5368717704}, "count": 42}, {"address": {"type": "absolute", "value": 5368717832}, "count": 118}, {"address": {"type": "absolute", "value": 5368718520}, "count": 105}, {"address": {"type": "absolute", "value": 5368719444}, "count": 75}, {"address": {"type": "absolute", "value": 5368719708}, "count": 60}, {"address": {"type": "absolute", "value": 5368719836}, "count": 76}, {"address": {"type": "absolute", "value": 5368720028}, "count": 68}, {"address": {"type": "absolute", "value": 5368720200}, "count": 110}, {"address": {"type": "absolute", "value": 5368720768}, "count": 158}, {"address": {"type": "absolute", "value": 5368721624}, "count": 53}, {"address": {"type": "absolute", "value": 5368721760}, "count": 59}, {"address": {"type": "absolute", "value": 5368721972}, "count": 49}, {"address": {"type": "absolute", "value": 5368722088}, "count": 49}, {"address": {"type": "absolute", "value": 5368722212}, "count": 31}, {"address": {"type": "absolute", "value": 5368722272}, "count": 114}, {"address": {"type": "absolute", "value": 5368722424}, "count": 62}, {"address": {"type": "absolute", "value": 5368722600}, "count": 98}, {"address": {"type": "absolute", "value": 5368723376}, "count": 106}, {"address": {"type": "absolute", "value": 5368724148}, "count": 83}, {"address": {"type": "absolute", "value": 5368724620}, "count": 90}, {"address": {"type": "absolute", "value": 5368724948}, "count": 85}, {"address": {"type": "absolute", "value": 5368725580}, "count": 113}, {"address": {"type": "absolute", "value": 5368726408}, "count": 70}, {"address": {"type": "absolute", "value": 5368726888}, "count": 48}, {"address": {"type": "absolute", "value": 5368727832}, "count": 101}, {"address": {"type": "absolute", "value": 5368728572}, "count": 74}, {"address": {"type": "absolute", "value": 5368728800}, "count": 36}, {"address": {"type": "absolute", "value": 5368729005}, "count": 8}, {"address": {"type": "absolute", "value": 5368729017}, "count": 8}, {"address": {"type": "absolute", "value": 5368729072}, "count": 9}, {"address": {"type": "absolute", "value": 5368729088}, "count": 19}]}, "library_functions": [{"address": {"type": "absolute", "value": 5368714016}, "name": "mainCRTStartup"}, {"address": {"type": "absolute", "value": 5368714064}, "name": "__security_check_cookie"}, {"address": {"type": "absolute", "value": 5368714100}, "name": "__raise_securityfailure"}, {"address": {"type": "absolute", "value": 5368714160}, "name": "__report_gsfailure"}, {"address": {"type": "absolute", "value": 5368714880}, "name": "__CxxSetUnhandledExceptionFilter"}, {"address": {"type": "absolute", "value": 5368715120}, "name": "_FindPESection"}, {"address": {"type": "absolute", "value": 5368715200}, "name": "_IsNonwritableInCurrentImage"}, {"address": {"type": "absolute", "value": 5368715348}, "name": "__security_init_cookie"}, {"address": {"type": "absolute", "value": 5368727008}, "name": "NetpGetTimeFormat"}, {"address": {"type": "absolute", "value": 5368728872}, "name": "__GSHandlerCheck"}, {"address": {"type": "absolute", "value": 5368728908}, "name": "__GSHandlerCheckCommon"}, {"address": {"type": "absolute", "value": 5368729040}, "name": "_guard_dispatch_icall_nop"}, {"address": {"type": "absolute", "value": 5368729136}, "name": "?"}]}}, "rules": {"delay execution": {"meta": {"name": "delay execution", "authors": ["michael.hunhoff@mandiant.com", "@ramen0x3f"], "scopes": {"static": "basic block", "dynamic": "call"}, "attack": [], "mbc": [{"parts": ["Anti-Behavioral Analysis", "Dynamic Analysis Evasion", "Delayed Execution"], "objective": "Anti-Behavioral Analysis", "behavior": "Dynamic Analysis Evasion", "method": "Delayed Execution", "id": "B0003.003"}], "references": ["https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions", "https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp"], "examples": ["al-khaser_x86.exe_:0x449770", "B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402FA6"], "description": "", "lib": true, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: delay execution\n    authors:\n      - michael.hunhoff@mandiant.com\n      - \"@ramen0x3f\"\n    lib: true\n    scopes:\n      static: basic block\n      dynamic: call\n    mbc:\n      - Anti-Behavioral Analysis::Dynamic Analysis Evasion::Delayed Execution [B0003.003]\n    references:\n      - https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp\n    examples:\n      - al-khaser_x86.exe_:0x449770\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402FA6\n  features:\n    - or:\n      - and:\n        - os: windows\n        - or:\n          - api: kernel32.Sleep\n          - api: kernel32.SleepEx\n          - api: kernel32.WaitForSingleObject\n          - api: kernel32.SignalObjectAndWait\n          - api: kernel32.WaitForSingleObjectEx\n          - api: kernel32.WaitForMultipleObjects\n          - api: kernel32.WaitForMultipleObjectsEx\n          - api: kernel32.RegisterWaitForSingleObject\n          - api: WaitOnAddress\n          - api: user32.MsgWaitForMultipleObjects\n          - api: user32.MsgWaitForMultipleObjectsEx\n          - api: NtDelayExecution\n          - api: KeWaitForSingleObject\n          - api: KeDelayExecutionThread\n      - and:\n        - os: linux\n        - or:\n          - api: sleep\n          - api: usleep\n", "matches": [[{"type": "absolute", "value": 5368713599}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "os", "os": "linux"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "sleep"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "usleep"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "os", "os": "windows"}}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "Sleep"}}, "children": [], "locations": [{"type": "absolute", "value": 5368713604}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SleepEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "WaitForSingleObject"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SignalObjectAndWait"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "WaitForSingleObjectEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "WaitForMultipleObjects"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "WaitForMultipleObjectsEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegisterWaitForSingleObject"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "WaitOnAddress"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "MsgWaitForMultipleObjects"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "MsgWaitForMultipleObjectsEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtDelayExecution"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "KeWaitForSingleObject"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "KeDelayExecutionThread"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "create or open registry key": {"meta": {"name": "create or open registry key", "authors": ["michael.hunhoff@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scopes": {"static": "basic block", "dynamic": "call"}, "attack": [], "mbc": [{"parts": ["Operating System", "Registry", "Create Registry Key"], "objective": "Operating System", "behavior": "Registry", "method": "Create Registry Key", "id": "C0036.004"}, {"parts": ["Operating System", "Registry", "Open Registry Key"], "objective": "Operating System", "behavior": "Registry", "method": "Open Registry Key", "id": "C0036.003"}], "references": [], "examples": ["Practical Malware Analysis Lab 03-02.dll_:0x10004706", "Practical Malware Analysis Lab 11-01.exe_:0x401000", "493167E85E45363D09495D0841C30648:0x404D60", "B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x4045F2", "B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x40433E", "692f7fd6d198e804d6af98eb9e390d61:0x6000003"], "description": "", "lib": true, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: create or open registry key\n    authors:\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    lib: true\n    scopes:\n      static: basic block\n      dynamic: call\n    mbc:\n      - Operating System::Registry::Create Registry Key [C0036.004]\n      - Operating System::Registry::Open Registry Key [C0036.003]\n    examples:\n      - Practical Malware Analysis Lab 03-02.dll_:0x10004706\n      - Practical Malware Analysis Lab 11-01.exe_:0x401000\n      - 493167E85E45363D09495D0841C30648:0x404D60\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x4045F2\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x40433E\n      - 692f7fd6d198e804d6af98eb9e390d61:0x6000003\n  features:\n    - or:\n      - api: advapi32.RegOpenKey\n      - api: advapi32.RegOpenKeyEx\n      - api: advapi32.RegCreateKey\n      - api: advapi32.RegCreateKeyEx\n      - api: advapi32.RegOpenCurrentUser\n      - api: advapi32.RegOpenKeyTransacted\n      - api: advapi32.RegOpenUserClassesRoot\n      - api: advapi32.RegCreateKeyTransacted\n      - api: ZwOpenKey\n      - api: ZwOpenKeyEx\n      - api: ZwCreateKey\n      - api: ZwOpenKeyTransacted\n      - api: ZwOpenKeyTransactedEx\n      - api: ZwCreateKeyTransacted\n      - api: NtOpenKey\n      - api: NtCreateKey\n      - api: SHRegOpenUSKey\n      - api: SHRegCreateUSKey\n      - api: RtlCreateRegistryKey\n      - api: Microsoft.Win32.RegistryKey::OpenSubKey\n      - api: Microsoft.Win32.RegistryKey::OpenBaseKey\n      - api: Microsoft.Win32.RegistryKey::OpenRemoteBaseKey\n      - api: Microsoft.Win32.RegistryKey::CreateSubKey\n", "matches": [[{"type": "absolute", "value": 5368722424}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegOpenKey"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "RegOpenKeyEx"}}, "children": [], "locations": [{"type": "absolute", "value": 5368722477}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegCreateKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegCreateKeyEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegOpenCurrentUser"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegOpenKeyTransacted"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegOpenUserClassesRoot"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegCreateKeyTransacted"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwOpenKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwOpenKeyEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwCreateKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwOpenKeyTransacted"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwOpenKeyTransactedEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwCreateKeyTransacted"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtOpenKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtCreateKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegOpenUSKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegCreateUSKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RtlCreateRegistryKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenSubKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenBaseKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::CreateSubKey"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "parse PE header": {"meta": {"name": "parse PE header", "namespace": "load-code/pe", "authors": ["moritz.raabe@mandiant.com"], "scopes": {"static": "function"}, "attack": [{"parts": ["Execution", "Shared Modules"], "tactic": "Execution", "technique": "Shared Modules", "subtechnique": "", "id": "T1129"}], "mbc": [], "references": [], "examples": ["9324D1A8AE37A36AE560C37448C9705A:0x403DD0"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: parse PE header\n    namespace: load-code/pe\n    authors:\n      - moritz.raabe@mandiant.com\n    scopes:\n      static: function\n      dynamic: unsupported  # requires mnemonic, operand[1].offset features\n    att&ck:\n      - Execution::Shared Modules [T1129]\n    examples:\n      - 9324D1A8AE37A36AE560C37448C9705A:0x403DD0\n  features:\n    - and:\n      - os: windows\n      - and:\n        - mnemonic: cmp\n        - or:\n          - number: 0x4550 = IMAGE_NT_SIGNATURE (PE)\n          - and:\n            - number: 0x50\n            - number: 0x45\n        - or:\n          - number: 0x5A4D = IMAGE_DOS_SIGNATURE (MZ)\n          - and:\n            - number: 0x4D\n            - number: 0x5A\n        - optional:\n          - and:\n            - operand[1].offset: 0x3C = IMAGE_DOS_HEADER.e_lfanew\n            - or:\n              - and:\n                - arch: i386\n                - operand[1].offset: 0x50 = IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage\n                - operand[1].offset: 0x34 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase\n              - and:\n                - arch: amd64\n                - operand[1].offset: 0x50 = IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage\n                - operand[1].offset: 0x30 = IMAGE_NT_HEADERS64.OptionalHeader.ImageBase\n          - basic block:\n            - and:\n              - operand[1].offset: 0x3C = IMAGE_DOS_HEADER.e_lfanew\n              - 3 or more:\n                - operand[1].offset: 0x4 = IMAGE_NT_HEADERS.FileHeader.Machine\n                - operand[1].offset: 0x6 = IMAGE_NT_HEADERS.FileHeader.NumberOfSections\n                - operand[1].offset: 0x14 = IMAGE_NT_HEADERS.FileHeader.SizeOfOptionalHeader\n                - operand[1].offset: 0x16 = IMAGE_NT_HEADERS.FileHeader.Characteristics\n                - operand[1].offset: 0x28 = IMAGE_NT_HEADERS.OptionalHeader.AddressOfEntryPoint  # for 32 and 64 bit\n                - or:\n                  - and:\n                    - arch: i386\n                    - operand[1].offset: 0x34 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase\n                    - operand[1].offset: 0x50 = IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage\n                  - and:\n                    - arch: amd64\n                    - operand[1].offset: 0x30 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase\n                    - operand[1].offset: 0x50 = IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage\n", "matches": [[{"type": "absolute", "value": 5368713232}, {"success": true, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "os", "os": "windows"}}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "mnemonic", "mnemonic": "cmp"}}, "children": [], "locations": [{"type": "absolute", "value": 5368713312}, {"type": "absolute", "value": 5368713284}, {"type": "absolute", "value": 5368713414}, {"type": "absolute", "value": 5368713322}, {"type": "absolute", "value": 5368713295}, {"type": "absolute", "value": 5368713328}, {"type": "absolute", "value": 5368713271}, {"type": "absolute", "value": 5368713303}, {"type": "absolute", "value": 5368713241}], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "number", "number": 17744, "description": "IMAGE_NT_SIGNATURE (PE)"}}, "children": [], "locations": [{"type": "absolute", "value": 5368713271}], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 80}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 69}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "number", "number": 23117, "description": "IMAGE_DOS_SIGNATURE (MZ)"}}, "children": [], "locations": [{"type": "absolute", "value": 5368713236}], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 77}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 90}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 60, "description": "IMAGE_DOS_HEADER.e_lfanew"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "arch", "arch": "i386"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 80, "description": "IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 52, "description": "IMAGE_NT_HEADERS.OptionalHeader.ImageBase"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "arch", "arch": "amd64"}}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 80, "description": "IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 48, "description": "IMAGE_NT_HEADERS64.OptionalHeader.ImageBase"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "parse PE header/66ae87bbecc5465fbc4b0f42a1cd45dd"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368714924}, {"success": true, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "os", "os": "windows"}}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "mnemonic", "mnemonic": "cmp"}}, "children": [], "locations": [{"type": "absolute", "value": 5368714945}, {"type": "absolute", "value": 5368714950}, {"type": "absolute", "value": 5368714934}, {"type": "absolute", "value": 5368714955}, {"type": "absolute", "value": 5368714975}], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "number", "number": 17744, "description": "IMAGE_NT_SIGNATURE (PE)"}}, "children": [], "locations": [{"type": "absolute", "value": 5368714975}], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 80}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 69}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "number", "number": 23117, "description": "IMAGE_DOS_SIGNATURE (MZ)"}}, "children": [], "locations": [{"type": "absolute", "value": 5368714940}], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 77}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 90}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 60, "description": "IMAGE_DOS_HEADER.e_lfanew"}}, "children": [], "locations": [{"type": "absolute", "value": 5368714964}], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "arch", "arch": "i386"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 80, "description": "IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 52, "description": "IMAGE_NT_HEADERS.OptionalHeader.ImageBase"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "arch", "arch": "amd64"}}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 80, "description": "IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 48, "description": "IMAGE_NT_HEADERS64.OptionalHeader.ImageBase"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "parse PE header/66ae87bbecc5465fbc4b0f42a1cd45dd"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368715296}, {"success": true, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "os", "os": "windows"}}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "mnemonic", "mnemonic": "cmp"}}, "children": [], "locations": [{"type": "absolute", "value": 5368715328}, {"type": "absolute", "value": 5368715313}, {"type": "absolute", "value": 5368715301}], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "number", "number": 17744, "description": "IMAGE_NT_SIGNATURE (PE)"}}, "children": [], "locations": [{"type": "absolute", "value": 5368715313}], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 80}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 69}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "number", "number": 23117, "description": "IMAGE_DOS_SIGNATURE (MZ)"}}, "children": [], "locations": [{"type": "absolute", "value": 5368715296}], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 77}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "number", "number": 90}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 60, "description": "IMAGE_DOS_HEADER.e_lfanew"}}, "children": [], "locations": [{"type": "absolute", "value": 5368715306}], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "arch", "arch": "i386"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 80, "description": "IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 52, "description": "IMAGE_NT_HEADERS.OptionalHeader.ImageBase"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "arch", "arch": "amd64"}}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 80, "description": "IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "operand offset", "index": 1, "operand_offset": 48, "description": "IMAGE_NT_HEADERS64.OptionalHeader.ImageBase"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "parse PE header/66ae87bbecc5465fbc4b0f42a1cd45dd"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "contain loop": {"meta": {"name": "contain loop", "authors": ["moritz.raabe@mandiant.com"], "scopes": {"static": "function"}, "attack": [], "mbc": [], "references": [], "examples": ["08AC667C65D36D6542917655571E61C8:0x406EAA"], "description": "", "lib": true, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: contain loop\n    authors:\n      - moritz.raabe@mandiant.com\n    lib: true\n    scopes:\n      static: function\n      dynamic: unsupported  # requires characteristic features\n    examples:\n      - 08AC667C65D36D6542917655571E61C8:0x406EAA\n  features:\n    - or:\n      - characteristic: loop\n      - characteristic: tight loop\n      - characteristic: recursive call\n", "matches": [[{"type": "absolute", "value": 5368713536}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368713536}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368715688}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368715688}], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368716145}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368716304}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368716304}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368717220}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368717220}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368717704}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368717704}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368717832}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368717832}], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368718273}, {"type": "absolute", "value": 5368718164}, {"type": "absolute", "value": 5368718229}, {"type": "absolute", "value": 5368718343}, {"type": "absolute", "value": 5368718061}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368718520}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368718520}], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368719296}, {"type": "absolute", "value": 5368718918}, {"type": "absolute", "value": 5368719238}, {"type": "absolute", "value": 5368719127}, {"type": "absolute", "value": 5368718732}, {"type": "absolute", "value": 5368719375}, {"type": "absolute", "value": 5368718676}, {"type": "absolute", "value": 5368719029}, {"type": "absolute", "value": 5368718807}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368719444}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368719444}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368720028}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368720028}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368720200}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368720200}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368720768}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368720768}], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368721424}, {"type": "absolute", "value": 5368721542}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368721624}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368721715}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368721760}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368721760}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368721972}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368721972}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368722212}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368722212}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368722272}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368722272}], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368722367}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368722600}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368722600}], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368723168}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368724620}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368724620}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368724948}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368724948}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368725580}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368725646}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368726408}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368726408}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368726888}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368726888}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368727832}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368727832}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368728572}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368728617}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368728800}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "loop"}}, "children": [], "locations": [{"type": "absolute", "value": 5368728800}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "tight loop"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "characteristic", "characteristic": "recursive call"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "terminate process": {"meta": {"name": "terminate process", "namespace": "host-interaction/process/terminate", "authors": ["moritz.raabe@mandiant.com", "michael.hunhoff@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scopes": {"static": "function", "dynamic": "thread"}, "attack": [], "mbc": [{"parts": ["Process", "Terminate Process"], "objective": "Process", "behavior": "Terminate Process", "method": "", "id": "C0018"}], "references": [], "examples": ["C91887D861D9BD4A5872249B641BC9F9:0x401A77", "9B7CCAA2AE6A5B96E3110EBCBC4311F6:0x10010307"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: terminate process\n    namespace: host-interaction/process/terminate\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scopes:\n      static: function\n      dynamic: thread\n    mbc:\n      - Process::Terminate Process [C0018]\n    examples:\n      - C91887D861D9BD4A5872249B641BC9F9:0x401A77\n      - 9B7CCAA2AE6A5B96E3110EBCBC4311F6:0x10010307\n  features:\n    - or:\n      - api: System.Diagnostics.Process::Kill\n      - api: System.Diagnostics.Process::WaitForExit\n      - api: System.Diagnostics.Process::WaitForExitAsync\n      - api: System.Environment::Exit\n      - api: System.Windows.Forms.Application::Exit\n      - api: exit\n      - api: Exit\n      - and:\n        - optional:\n          - match: open process\n        - or:\n          - api: kernel32.TerminateProcess\n          - api: ntdll.NtTerminateProcess\n          - api: kernel32.ExitProcess\n", "matches": [[{"type": "absolute", "value": 5368715688}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::Kill"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExitAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Environment::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Windows.Forms.Application::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "exit"}}, "children": [], "locations": [{"type": "absolute", "value": 5368716282}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "open process"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "TerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtTerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ExitProcess"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368717704}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::Kill"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExitAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Environment::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Windows.Forms.Application::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "exit"}}, "children": [], "locations": [{"type": "absolute", "value": 5368717813}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "open process"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "TerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtTerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ExitProcess"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368717832}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::Kill"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExitAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Environment::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Windows.Forms.Application::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "exit"}}, "children": [], "locations": [{"type": "absolute", "value": 5368718499}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "open process"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "TerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtTerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ExitProcess"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368719444}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::Kill"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExitAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Environment::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Windows.Forms.Application::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "exit"}}, "children": [], "locations": [{"type": "absolute", "value": 5368719572}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "open process"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "TerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtTerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ExitProcess"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368720200}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::Kill"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExitAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Environment::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Windows.Forms.Application::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "exit"}}, "children": [], "locations": [{"type": "absolute", "value": 5368720681}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "open process"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "TerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtTerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ExitProcess"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "absolute", "value": 5368723376}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::Kill"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Diagnostics.Process::WaitForExitAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Environment::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Windows.Forms.Application::Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "exit"}}, "children": [], "locations": [{"type": "absolute", "value": 5368724129}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Exit"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "open process"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "TerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtTerminateProcess"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ExitProcess"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "write file on Windows": {"meta": {"name": "write file on Windows", "namespace": "host-interaction/file-system/write", "authors": ["william.ballenthin@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scopes": {"static": "function", "dynamic": "thread"}, "attack": [], "mbc": [{"parts": ["File System", "Writes File"], "objective": "File System", "behavior": "Writes File", "method": "", "id": "C0052"}], "references": [], "examples": ["Practical Malware Analysis Lab 01-04.exe_:0x4011FC", "563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x1400025C4"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: write file on Windows\n    namespace: host-interaction/file-system/write\n    authors:\n      - william.ballenthin@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scopes:\n      static: function\n      dynamic: thread\n    mbc:\n      - File System::Writes File [C0052]\n    examples:\n      - Practical Malware Analysis Lab 01-04.exe_:0x4011FC\n      # ntdll\n      - 563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x1400025C4\n  features:\n    - or:\n      - and:\n        - os: windows\n        - optional:\n          - basic block:\n            - or:\n              - number: 0x40000000 = GENERIC_WRITE\n              - number: 0x2 = FILE_WRITE_DATA\n              - match: create or open file\n          - call:\n            - or:\n              - number: 0x40000000 = GENERIC_WRITE\n              - number: 0x2 = FILE_WRITE_DATA\n              - match: create or open file\n        - or:\n          - api: kernel32.WriteFile\n          - api: kernel32.WriteFileEx\n          - api: NtWriteFile\n          - api: ZwWriteFile\n          - api: _fwrite\n          - api: fwrite\n      - api: System.IO.File::WriteAllBytes\n      - api: System.IO.File::WriteAllBytesAsync\n      - api: System.IO.File::WriteAllLines\n      - api: System.IO.File::WriteAllLinesAsync\n      - api: System.IO.File::WriteAllText\n      - api: System.IO.File::WriteAllTextAsync\n      - api: System.IO.File::AppendAllLines\n      - api: System.IO.File::AppendAllLinesAsync\n      - api: System.IO.File::AppendAllText\n      - api: System.IO.File::AppendAllTextAsync\n      - api: System.IO.File::AppendText\n      - api: System.IO.FileInfo::AppendText\n", "matches": [[{"type": "absolute", "value": 5368716704}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::WriteAllBytes"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::WriteAllBytesAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::WriteAllLines"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::WriteAllLinesAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::WriteAllText"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::WriteAllTextAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::AppendAllLines"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::AppendAllLinesAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::AppendAllText"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::AppendAllTextAsync"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.File::AppendText"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.IO.FileInfo::AppendText"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "os", "os": "windows"}}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "write file on Windows/8d88346cbcb1491da8d58aeee4f27cf7"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "match", "match": "write file on Windows/f59973cb949d45439510dacfe677b50f"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "WriteFile"}}, "children": [], "locations": [{"type": "absolute", "value": 5368716990}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "WriteFileEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtWriteFile"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwWriteFile"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "_fwrite"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "fwrite"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "query or enumerate registry value": {"meta": {"name": "query or enumerate registry value", "namespace": "host-interaction/registry", "authors": ["william.ballenthin@mandiant.com", "michael.hunhoff@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scopes": {"static": "function", "dynamic": "thread"}, "attack": [{"parts": ["Discovery", "Query Registry"], "tactic": "Discovery", "technique": "Query Registry", "subtechnique": "", "id": "T1012"}], "mbc": [{"parts": ["Operating System", "Registry", "Query Registry Value"], "objective": "Operating System", "behavior": "Registry", "method": "Query Registry Value", "id": "C0036.006"}], "references": [], "examples": ["BFB9B5391A13D0AFD787E87AB90F14F5:0x13145B5A", "Practical Malware Analysis Lab 03-02.dll_:0x100047AD"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: query or enumerate registry value\n    namespace: host-interaction/registry\n    authors:\n      - william.ballenthin@mandiant.com\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scopes:\n      static: function\n      dynamic: thread\n    att&ck:\n      - Discovery::Query Registry [T1012]\n    mbc:\n      - Operating System::Registry::Query Registry Value [C0036.006]\n    examples:\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145B5A\n      - Practical Malware Analysis Lab 03-02.dll_:0x100047AD\n  features:\n    - and:\n      - optional:\n        - match: create or open registry key\n      - or:\n        - api: advapi32.RegGetValue\n        - api: advapi32.RegEnumValue\n        - api: advapi32.RegQueryValue\n        - api: advapi32.RegQueryValueEx\n        - api: advapi32.RegQueryMultipleValues\n        - api: ZwQueryValueKey\n        - api: ZwEnumerateValueKey\n        - api: NtQueryValueKey\n        - api: NtEnumerateValueKey\n        - api: RtlQueryRegistryValues\n        - api: SHGetValue\n        - api: SHEnumValue\n        - api: SHRegGetInt\n        - api: SHRegGetPath\n        - api: SHRegGetValue\n        - api: SHQueryValueEx\n        - api: SHRegGetUSValue\n        - api: SHOpenRegStream\n        - api: SHRegEnumUSValue\n        - api: SHOpenRegStream2\n        - api: SHRegQueryUSValue\n        - api: SHRegGetBoolUSValue\n        - api: SHRegGetValueFromHKCUHKLM\n        - api: SHRegGetBoolValueFromHKCUHKLM\n        - api: Microsoft.Win32.RegistryKey::GetValue\n        - api: Microsoft.Win32.RegistryKey::GetValueKind\n        - api: Microsoft.Win32.RegistryKey::GetValueNames\n        - api: Microsoft.Win32.Registry::GetValue\n", "matches": [[{"type": "absolute", "value": 5368722424}, {"success": true, "node": {"type": "statement", "statement": {"type": "and"}}, "children": [{"success": true, "node": {"type": "statement", "statement": {"type": "optional"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "match", "match": "create or open registry key"}}, "children": [{"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegOpenKey"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "RegOpenKeyEx"}}, "children": [], "locations": [{"type": "absolute", "value": 5368722477}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegCreateKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegCreateKeyEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegOpenCurrentUser"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegOpenKeyTransacted"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegOpenUserClassesRoot"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegCreateKeyTransacted"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwOpenKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwOpenKeyEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwCreateKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwOpenKeyTransacted"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwOpenKeyTransactedEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwCreateKeyTransacted"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtOpenKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtCreateKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegOpenUSKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegCreateUSKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RtlCreateRegistryKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenSubKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenBaseKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::CreateSubKey"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [{"type": "absolute", "value": 5368722424}], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegGetValue"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegEnumValue"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegQueryValue"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "RegQueryValueEx"}}, "children": [], "locations": [{"type": "absolute", "value": 5368722533}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RegQueryMultipleValues"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwQueryValueKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "ZwEnumerateValueKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtQueryValueKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "NtEnumerateValueKey"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "RtlQueryRegistryValues"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHGetValue"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHEnumValue"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegGetInt"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegGetPath"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegGetValue"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHQueryValueEx"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegGetUSValue"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHOpenRegStream"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegEnumUSValue"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHOpenRegStream2"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegQueryUSValue"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegGetBoolUSValue"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegGetValueFromHKCUHKLM"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "SHRegGetBoolValueFromHKCUHKLM"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::GetValue"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::GetValueKind"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::GetValueNames"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "Microsoft.Win32.Registry::GetValue"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "accept command line arguments": {"meta": {"name": "accept command line arguments", "namespace": "host-interaction/cli", "authors": ["moritz.raabe@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scopes": {"static": "function", "dynamic": "call"}, "attack": [{"parts": ["Execution", "Command and Scripting Interpreter"], "tactic": "Execution", "technique": "Command and Scripting Interpreter", "subtechnique": "", "id": "T1059"}], "mbc": [{"parts": ["Execution", "Command and Scripting Interpreter"], "objective": "Execution", "behavior": "Command and Scripting Interpreter", "method": "", "id": "E1059"}], "references": [], "examples": ["e5369ac309f1be6d77afeeb3edab0ed8:0x402760"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: accept command line arguments\n    namespace: host-interaction/cli\n    authors:\n      - moritz.raabe@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scopes:\n      static: function\n      dynamic: call\n    att&ck:\n      - Execution::Command and Scripting Interpreter [T1059]\n    mbc:\n      - Execution::Command and Scripting Interpreter [E1059]\n    examples:\n      - e5369ac309f1be6d77afeeb3edab0ed8:0x402760\n  features:\n    - or:\n      - api: GetCommandLine\n      - api: CommandLineToArgv\n      - api: System.Environment::GetCommandLineArgs\n", "matches": [[{"type": "absolute", "value": 5368723376}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "GetCommandLine"}}, "children": [], "locations": [{"type": "absolute", "value": 5368723704}], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "CommandLineToArgv"}}, "children": [], "locations": [{"type": "absolute", "value": 5368723724}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Environment::GetCommandLineArgs"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "query environment variable": {"meta": {"name": "query environment variable", "namespace": "host-interaction/environment-variable", "authors": ["michael.hunhoff@mandiant.com", "@_re_fox"], "scopes": {"static": "function", "dynamic": "call"}, "attack": [{"parts": ["Discovery", "System Information Discovery"], "tactic": "Discovery", "technique": "System Information Discovery", "subtechnique": "", "id": "T1082"}], "mbc": [{"parts": ["Discovery", "System Information Discovery"], "objective": "Discovery", "behavior": "System Information Discovery", "method": "", "id": "E1082"}], "references": [], "examples": ["Practical Malware Analysis Lab 14-02.exe_:0x401880", "0761142efbda6c4b1e801223de723578:0x65483490"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: query environment variable\n    namespace: host-interaction/environment-variable\n    authors:\n      - michael.hunhoff@mandiant.com\n      - \"@_re_fox\"\n    scopes:\n      static: function\n      dynamic: call\n    att&ck:\n      - Discovery::System Information Discovery [T1082]\n    mbc:\n      - Discovery::System Information Discovery [E1082]\n    examples:\n      - Practical Malware Analysis Lab 14-02.exe_:0x401880\n      - 0761142efbda6c4b1e801223de723578:0x65483490\n  features:\n    - or:\n      - api: kernel32.GetEnvironmentVariable\n      - api: kernel32.GetEnvironmentStrings\n      - api: kernel32.ExpandEnvironmentStrings\n      - api: msvcr90.getenv\n      - api: msvcrt.getenv\n      - api: System.Environment::GetEnvironmentVariable\n      - api: System.Environment::GetEnvironmentVariables\n      - api: System.Environment::ExpandEnvironmentVariables\n", "matches": [[{"type": "absolute", "value": 5368723376}, {"success": true, "node": {"type": "statement", "statement": {"type": "or"}}, "children": [{"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "GetEnvironmentVariable"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "GetEnvironmentStrings"}}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"type": "feature", "feature": {"type": "api", "api": "ExpandEnvironmentStrings"}}, "children": [], "locations": [{"type": "absolute", "value": 5368723617}], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "getenv"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "getenv"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Environment::GetEnvironmentVariable"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Environment::GetEnvironmentVariables"}}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"type": "feature", "feature": {"type": "api", "api": "System.Environment::ExpandEnvironmentVariables"}}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}}}